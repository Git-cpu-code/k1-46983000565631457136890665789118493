<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR/VR Klaviertastatur</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/jsm/controls/OrbitControls.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/jsm/webxr/WebXRManager.js"></script>

    <script>
        let scene, camera, renderer, pianoKeys = [], notes = [], staff;

        // Setup AR scene
        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            renderer.xr.enabled = true;
            document.body.appendChild(ARButton.createButton(renderer));

            // Create a piano keyboard
            createPiano();

            // Add staff for note display
            createStaff();

            // Orbit Controls (only for VR/Desktop, not AR)
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            camera.position.set(0, 1.6, 2);
            controls.update();

            animate();
        }

        // Piano creation
        function createPiano() {
            let whiteKeyMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
            let blackKeyMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });

            // Generate white and black keys (basic example with 14 keys, 7 white, 5 black)
            for (let i = 0; i < 7; i++) {
                let whiteKey = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.02, 0.4), whiteKeyMaterial);
                whiteKey.position.set(i * 0.12 - 0.36, 1.6, 0);
                scene.add(whiteKey);
                pianoKeys.push({ note: "C" + i, key: whiteKey });

                if (i < 6) {
                    let blackKey = new THREE.Mesh(new THREE.BoxGeometry(0.05, 0.02, 0.2), blackKeyMaterial);
                    blackKey.position.set(i * 0.12 - 0.30, 1.61, -0.1);
                    scene.add(blackKey);
                    pianoKeys.push({ note: "C#" + i, key: blackKey });
                }
            }
        }

        // Create staff (where notes are displayed)
        function createStaff() {
            const loader = new THREE.TextureLoader();
            loader.load('./images/staff.png', function(texture) {
                const staffGeometry = new THREE.PlaneGeometry(2, 0.5);
                const staffMaterial = new THREE.MeshBasicMaterial({ map: texture });
                staff = new THREE.Mesh(staffGeometry, staffMaterial);
                staff.position.set(0, 1.8, -2);
                scene.add(staff);
            });
        }

        // Display note on staff
        function displayNoteOnStaff(note) {
            // Use an image corresponding to the note (e.g., C4.png)
            const loader = new THREE.TextureLoader();
            loader.load('./images/' + note + '.png', function(texture) {
                const noteGeometry = new THREE.PlaneGeometry(0.2, 0.2);
                const noteMaterial = new THREE.MeshBasicMaterial({ map: texture });
                let noteMesh = new THREE.Mesh(noteGeometry, noteMaterial);
                noteMesh.position.set(0, 1.8, -2); // Adjust position as needed
                scene.add(noteMesh);

                // Fade out after a few seconds
                setTimeout(() => {
                    scene.remove(noteMesh);
                }, 3000);
            });
        }

        // Handle key press
        function onKeyPress(note) {
            // Play corresponding sound
            let audio = new Audio('./sounds/' + note + '.mp3');
            audio.play();

            // Display note on staff
            displayNoteOnStaff(note);
        }

        // Animation loop
        function animate() {
            renderer.setAnimationLoop(() => {
                renderer.render(scene, camera);
            });
        }

        // Resize handling
        window.addEventListener('resize', function() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        init();
    </script>
</body>
</html>
